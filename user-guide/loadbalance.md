# 3.6 负载均衡
七牛容器云平台支持7层「HTTP/HTTPS」和4层「TCP」两种类型的负载均衡。「HTTP/HTTPS」支持用户绑定自有域名，将服务以自有域名入口的形式暴露到集群外部。

## 3.6.1 HTTP/HTTPS

### 添加负载均衡

1）点击控制台左边栏的「负载均衡」，切换至负载均衡界面。

2）点击「HTTP/HTTPS」，切换至7层负载均衡Tab

3）点击「添加负载均衡」

![添加负载均衡](_figures/user-guide/lb-7.png)

4）填写负载均衡的名称。

?> 要求：2 - 64 位的小写字母、数字或"-"，不能以"-"开头或结尾。

5）填写负载均衡的描述，可选。

6）选择负载均衡的计费方式，目前仅支持以流量的方式计费。

7）为负载均衡添加自定义域名。域名的添加，请参考[3.9](user-guide/domain.md)。系统会为每个负载均衡分配一个可访问的测试域名。

!> 注意：只能添加已经完成绑定的域名，并且每个域名只能添加至一个负载均衡。

?> **测试域名** - 仅供测试使用，限总流量，限单IP访问频率，限速，无法用于自有域名的CNAME  
**自有域名** - 在「域名管理」中添加，CNAME成功后，允许配置到负载均衡，且一次只能配置到一个。

8）为负载均衡添加映射关系。一组映射关系关联了「路径」和「应用/服务/端口」,每个负载均衡可以添加多组映射关系。

?> 每一条映射关系都允许所有「域名」的路径能够访问对应的「服务」端口

![添加负载均衡](_figures/user-guide/lb-7-create.png)

### 编辑负载均衡

9）点击「负载均衡」后的编辑按钮，可以进入负载均衡编辑页面。

在编辑页面中，可以修改负载均衡的描述、增删绑定的域名、增删或修改映射关系。

![添加负载均衡](_figures/user-guide/lb-7-edit.png)

### 删除负载均衡

9）点击「负载均衡」后的删除按钮，可以删除负载均衡。删除后，负载均衡将无法恢复，请谨慎操作。

![添加负载均衡](_figures/user-guide/lb-7-delete.png)

## 3.6.2 TCP

### 添加负载均衡

1）点击控制台左边栏的「负载均衡」，切换至负载均衡界面。

2）点击「TCP」，切换至4层负载均衡Tab

3）点击「添加负载均衡」

![添加负载均衡](_figures/user-guide/lb-4.png)

4）填写负载均衡的名称。

?> 要求：2 - 64 位的小写字母、数字或"-"，不能以"-"开头或结尾。

5）填写负载均衡的描述，可选。

6）选择IP类型。

?> **内网：**支持集群内跨namespace访问  
   **电信：**支持集群外部访问  

7）选择负载均衡的计费方式，目前仅支持以带宽的方式计费。

8）选择带宽限制，范围为1-1000Mbps。

9）为负载均衡添加后端服务，点击「添加服务」，下拉选择服务。

10）为负载均衡添加转发规则，填写「监听端口」到「后端服务端口」的映射。

![添加负载均衡](_figures/user-guide/lb-4-create.png)

### 编辑负载均衡

11）点击「负载均衡」后的编辑按钮，可以进入负载均衡编辑页面。

在编辑页面中，可以修改负载均衡的描述、带宽限制、后端服务以及转发规则。

![添加负载均衡](_figures/user-guide/lb-4-edit.png)

### 删除负载均衡

9）点击「负载均衡」后的删除按钮，可以删除负载均衡。删除后，负载均衡将无法恢复，请谨慎操作。

![添加负载均衡](_figures/user-guide/lb-4-delete.png)

## 3.6.3 监控
平台同时支持面向七层「HTTP/HTTPS」负载均衡的域名监控，监控指标包含「流入流量」「流出流量」「QPS」「响应时间」「返回码」。监控数据最长保持一周。

![添加负载均衡](_figures/user-guide/loadbalance-7-monitor.png)
